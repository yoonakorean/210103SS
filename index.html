<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥å­è·Ÿè®€æŒ‘æˆ°</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; text-align: center; padding: 30px 15px; }
    #question-box { margin: 20px 0; }
    #user-audio.hidden { display: none; }
    button { margin: 5px; padding: 10px 15px; }
  </style>
</head>
<body>
  <h1 id="title">1-1 å¥å­è·Ÿè®€æŒ‘æˆ°</h1>
  <div id="question-box">
    <p id="question-text"></p>
    <p id="keywords"></p>
    <p><span id="current-number"></span> / <span id="total-number"></span></p>
    <audio id="audio-player" controls></audio>
  </div>
  <audio id="user-audio" controls class="hidden"></audio>
  <div>
    <button id="start-btn">ğŸ¤ é–‹å§‹éŒ„éŸ³</button>
    <button id="stop-btn" disabled>â¹ åœæ­¢éŒ„éŸ³</button>
    <button id="toggle-pro-mode">åˆ‡æ› Pro æ¨¡å¼</button>
  </div>

  <script>
    const questions = [
      { text: "ì•„ì¹¨ì— ë³´í†µ ì»¤í”¼ë¥¼ ë§ˆì‹œê±°ë‚˜ ë¹µì„ ë¨¹ì–´ìš”.", keywords: "ì»¤í”¼, ë¹µ", audio: "audio1.mp3" },
      { text: "ì£¼ë§ì— ì‹œê°„ì´ ìˆìœ¼ë©´ ë³´í†µ ì§‘ì—ì„œ ì²­ì†Œí•˜ê±°ë‚˜ ìŒì•…ì„ ë“¤ì–´ìš”.", keywords: "ì£¼ë§, ì²­ì†Œ, ìŒì•…", audio: "audio2.mp3" }
    ];

    let currentQuestion = 0;
    let isProMode = false;

    const questionText = document.getElementById("question-text");
    const keywordsDiv = document.getElementById("keywords");
    const currentNumberSpan = document.getElementById("current-number");
    const totalNumberSpan = document.getElementById("total-number");
    const audioPlayer = document.getElementById("audio-player");
    const userAudio = document.getElementById("user-audio");
    const startBtn = document.getElementById("start-btn");
    const stopBtn = document.getElementById("stop-btn");
    const proModeBtn = document.getElementById("toggle-pro-mode");

    totalNumberSpan.textContent = questions.length;

    // ğŸ§ å»ºç«‹å…±ç”¨ AudioContext
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let trackConnected = false;
    let userTrackConnected = false;

    function connectWithGain(element, gainValue, alreadyConnectedFlag) {
      if (!alreadyConnectedFlag.flag) {
        const source = audioCtx.createMediaElementSource(element);
        const gainNode = audioCtx.createGain();
        gainNode.gain.value = gainValue;
        source.connect(gainNode).connect(audioCtx.destination);
        alreadyConnectedFlag.flag = true;
      }
    }

    function showQuestion() {
      const q = questions[currentQuestion];
      questionText.textContent = q.text;
      keywordsDiv.textContent = `[${q.keywords}]`;
      currentNumberSpan.textContent = currentQuestion + 1;
      audioPlayer.src = q.audio;
      userAudio.classList.add("hidden");
      userAudio.src = "";

      questionText.style.visibility = isProMode ? "hidden" : "visible";
      keywordsDiv.style.visibility = isProMode ? "hidden" : "visible";
    }

    showQuestion();

    // ğŸŸ¢ ç¢ºä¿é»æ’­æ”¾æ™‚æ‰å»ºç«‹è²éŸ³ç®¡é“
    audioPlayer.addEventListener("play", () => {
      audioCtx.resume();
      connectWithGain(audioPlayer, 2, { get flag() { return trackConnected; }, set flag(v) { trackConnected = v; } });
    });

    userAudio.addEventListener("play", () => {
      audioCtx.resume();
      connectWithGain(userAudio, 2, { get flag() { return userTrackConnected; }, set flag(v) { userTrackConnected = v; } });
    });

    // Pro æ¨¡å¼
    proModeBtn.addEventListener("click", () => {
      isProMode = !isProMode;
      showQuestion();
    });

    // å½é€ éŒ„éŸ³æµç¨‹ï¼ˆç¤ºç¯„ç”¨ï¼‰
    startBtn.addEventListener("click", () => {
      startBtn.disabled = true;
      stopBtn.disabled = false;
      console.log("é–‹å§‹éŒ„éŸ³...");
    });

    stopBtn.addEventListener("click", () => {
      startBtn.disabled = false;
      stopBtn.disabled = true;
      console.log("åœæ­¢éŒ„éŸ³ï¼Œç”Ÿæˆå›æ”¾...");
      userAudio.src = "recorded.mp3"; // å‡è£éŒ„åˆ°éŸ³
      userAudio.classList.remove("hidden");
    });
  </script>
</body>
</html>
