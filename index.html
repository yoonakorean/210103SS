<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>1-3 å¥å­è·Ÿè®€æŒ‘æˆ°</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: auto;
      text-align: center;
      padding: 30px 15px;
    }
    #logo {
      width: 150px;
      max-width: 80%;
      margin-bottom: 10px;
    }
    #game-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #question-number {
      font-size: 18px;
      margin-bottom: 10px;
    }
    #question-selector {
      margin: 20px 0;
    }

    /* çµ±ä¸€æŒ‰éˆ•å¤§å° */
    button {
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #4a90e2;
      color: #fff;
    }

    /* é¡Œç›®é¸æ“‡æŒ‰éˆ• */
    .selector-btn {
      width: 40px;
      height: 40px;
      margin: 5px;
      padding: 0;
      border-radius: 50%;
    }

    .hidden {
      visibility: hidden;
    }
    audio {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      display: block;
    }

    /* å‚™è¨»å­—é«”å¤§å° */
    .note,
    .practice-hint,
    .pro-mode-hint {
      font-size: 14px;
      color: #888;
      margin: 5px 0;
    }

    /* é¡Œç›®èˆ‡é—œéµå­— */
    .question-text {
      font-size: 20px;
      margin-bottom: 10px;
      font-weight: bold; /* é¡Œç›®ç²—é«” */
    }
    .keywords {
      font-size: 20px;
      margin-bottom: 10px;
    }

    #question-controls {
      margin-top: 20px;
    }

    /* åˆ†æˆä¸‰è¡Œï¼ŒæŒ‰éˆ•æ°´å¹³æ’åˆ— */
    .audio-player-container,
    .user-audio-container {
      margin: 10px 0;
    }

    .record-btns {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }

    /* é«˜æ‰‹æ¨¡å¼æç¤ºç½®ä¸­ */
    .pro-mode-hint {
      margin: 15px 0 20px 0;
    }
  </style>
</head>
<body>
  <img id="logo" src="logo.png" alt="Logo">
  <div id="game-title">1-3 å¥å­è·Ÿè®€æŒ‘æˆ°</div>
  <div id="question-number">ç¬¬ <span id="current-number">1</span> é¡Œ / å…± 10 é¡Œ</div>
  <div id="question-selector"><strong>é¡Œç›®é¸æ“‡ï¼š</strong></div>

  <div id="question-text" class="question-text"></div>

  <div class="practice-hint">é€²éšç·´ç¿’ï¼šçœ‹è‘—é—œéµå­—ï¼Œè©¦è‘—èªªå‡ºå¥å­</div>
  <div id="keywords" class="keywords"></div>

  <button id="toggle-pro-mode">é«˜æ‰‹æ¨¡å¼</button>
  <div class="pro-mode-hint">é€²å…¥é«˜æ‰‹æ¨¡å¼å¾Œ é¡Œç›®èˆ‡é—œéµå­—éƒ½æœƒéš±è—</div>

  <div id="question-controls">
    <div class="audio-player-container">
      <audio id="audio-player" controls></audio>
    </div>

    <div class="record-btns">
      <button id="start-btn">é–‹å§‹éŒ„éŸ³</button>
      <button id="stop-btn" disabled>åœæ­¢éŒ„éŸ³</button>
    </div>

    <div class="user-audio-container">
      <audio id="user-audio" controls class="hidden"></audio>
    </div>
  </div>

  <!-- å¼•å…¥ recorder.js -->
  <script src="recorder.js"></script>

  <script>
    const questions = [
      { audio: "audio/21010301S.mp3", text: "ì•„ì¹¨ì— ë³´í†µ ì»¤í”¼ë¥¼ ë§ˆì‹œê±°ë‚˜ ë¹µì„ ë¨¹ì–´ìš”.", keywords: "ì•„ì¹¨, ì»¤í”¼, ë¹µ" },
      { audio: "audio/21010302S.mp3", text: "ì£¼ë§ì— ì‹œê°„ì´ ìˆìœ¼ë©´ ë³´í†µ ì§‘ì—ì„œ ì²­ì†Œí•˜ê±°ë‚˜ ìŒì•…ì„ ë“¤ì–´ìš”.", keywords: "ì£¼ë§, ì²­ì†Œ, ìŒì•…" },
      { audio: "audio/21010303S.mp3", text: "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ìœ¼ë©´ ìš´ë™ì„ í•˜ê±°ë‚˜ ë§›ìˆëŠ” ìŒì‹ì„ ë¨¹ì–´ìš”.", keywords: "ìŠ¤íŠ¸ë ˆìŠ¤, ìš´ë™, ìŒì‹" },
      { audio: "audio/21010304S.mp3", text: "ì¡¸ë¦¬ë©´ ì»¤í”¼ë¥¼ ë§ˆì‹œê±°ë‚˜ ì ê¹ ì‰¬ì„¸ìš”.", keywords: "ì¡¸ë¦¬ë‹¤, ì»¤í”¼, ì‰¬ë‹¤" },
      { audio: "audio/21010305S.mp3", text: "ë¹„ê°€ ì˜¤ë©´ íƒì‹œë¥¼ íƒ€ê±°ë‚˜ ì§‘ì— ìˆì–´ìš”.", keywords: "ë¹„, íƒì‹œ, ì§‘" },
      { audio: "audio/21010306S.mp3", text: "íšŒì˜ê°€ ëë‚˜ê³  ì ì‹¬ì„ ë¨¹ê±°ë‚˜ ì»¤í”¼ë¥¼ ë§ˆì‹¤ê¹Œìš”?", keywords: "íšŒì˜, ì ì‹¬, ì»¤í”¼" },
      { audio: "audio/21010307S.mp3", text: "ì´ ë¬¸ì œë¥¼ í˜¼ì í•´ê²°í•˜ê±°ë‚˜ ì„ ìƒë‹˜ê»˜ ë¬¼ì–´ë³´ì„¸ìš”.", keywords: "ë¬¸ì œ, í•´ê²°, ì„ ìƒë‹˜" },
      { audio: "audio/21010308S.mp3", text: "í•œêµ­ì–´ë¥¼ ë°°ìš°ê³  í•œêµ­ íšŒì‚¬ì— ì·¨ì§í•˜ê±°ë‚˜ ë²ˆì—­ì‚¬ê°€ ë˜ê³  ì‹¶ì–´ìš”.", keywords: "í•œêµ­ì–´, íšŒì‚¬, ë²ˆì—­ì‚¬" },
      { audio: "audio/21010309S.mp3", text: "ì‰¬ëŠ” ë‚ ì— ë³´í†µ ì§‘ì—ì„œ ë¹¨ë˜í•˜ê±°ë‚˜ ë„ì„œê´€ì— ê°€ì„œ ìˆ™ì œí•´ìš”.", keywords: "ì‰¬ëŠ” ë‚ , ë¹¨ë˜, ë„ì„œê´€" },
      { audio: "audio/21010310S.mp3", text: "ì¼ì´ ë§ìœ¼ë©´ ë™ë£Œí•œí…Œ ë¶€íƒí•˜ê±°ë‚˜ ì•¼ê·¼í•´ìš”.", keywords: "ì¼, ë™ë£Œ, ì•¼ê·¼" }
    ];

    let currentQuestion = 0;
    let isProMode = false;
    let recorder, audioContext, stream;

    const questionText = document.getElementById("question-text");
    const keywordsDiv = document.getElementById("keywords");
    const currentNumberSpan = document.getElementById("current-number");
    const audioPlayer = document.getElementById("audio-player");
    const userAudio = document.getElementById("user-audio");
    const startBtn = document.getElementById("start-btn");
    const stopBtn = document.getElementById("stop-btn");
    const proModeBtn = document.getElementById("toggle-pro-mode");

    // ğŸ”Š Web Audio APIï¼Œè®“æ’­æ”¾å™¨èˆ‡éŒ„éŸ³å›æ”¾éŸ³é‡é è¨­æ”¾å¤§ 2 å€
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // é¡Œç›®æ’­æ”¾å™¨æ”¾å¤§
    const track = audioCtx.createMediaElementSource(audioPlayer);
    const gainNode = audioCtx.createGain();
    gainNode.gain.value = 2; // æ”¾å¤§ 2 å€
    track.connect(gainNode).connect(audioCtx.destination);

    // éŒ„éŸ³å›æ”¾æ”¾å¤§
    const userTrack = audioCtx.createMediaElementSource(userAudio);
    const userGainNode = audioCtx.createGain();
    userGainNode.gain.value = 2; // æ”¾å¤§ 2 å€
    userTrack.connect(userGainNode).connect(audioCtx.destination);

    function showQuestion() {
      const q = questions[currentQuestion];
      questionText.textContent = q.text;
      keywordsDiv.textContent = `[${q.keywords}]`; // é—œéµå­—åŠ ä¸­æ‹¬è™Ÿ
      currentNumberSpan.textContent = currentQuestion + 1;
      audioPlayer.src = q.audio;
      userAudio.classList.add("hidden");
      userAudio.src = "";

      questionText.style.visibility = isProMode ? "hidden" : "visible";
      keywordsDiv.style.visibility = isProMode ? "hidden" : "visible";
    }

    showQuestion();

    // é¡Œç›®é¸æ“‡æŒ‰éˆ•
    const selector = document.getElementById("question-selector");
    questions.forEach((_, idx) => {
      const btn = document.createElement("button");
      btn.textContent = idx + 1;
      btn.className = "selector-btn";
      btn.onclick = () => {
        stopRecordingIfNeeded();
        currentQuestion = idx;
        showQuestion();
      };
      selector.appendChild(btn);
    });

    // é«˜æ‰‹æ¨¡å¼åˆ‡æ›
    proModeBtn.onclick = () => {
      isProMode = !isProMode;
      questionText.style.visibility = isProMode ? "hidden" : "visible";
      keywordsDiv.style.visibility = isProMode ? "hidden" : "visible";
      proModeBtn.textContent = isProMode ? "æ¢å¾©é¡Œç›®é¡¯ç¤º" : "é«˜æ‰‹æ¨¡å¼";
    };

    // éŒ„éŸ³é–‹å§‹
    startBtn.onclick = async () => {
      questionText.style.visibility = "hidden";

      stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const input = audioContext.createMediaStreamSource(stream);

      recorder = new Recorder(input, { numChannels: 1 });
      recorder.record();

      startBtn.disabled = true;
      stopBtn.disabled = false;
    };

    // éŒ„éŸ³åœæ­¢
    stopBtn.onclick = () => {
      recorder.stop();
      stream.getAudioTracks()[0].stop();

      recorder.exportWAV(blob => {
        userAudio.src = URL.createObjectURL(blob);
        userAudio.classList.remove("hidden");
      });

      questionText.style.visibility = isProMode ? "hidden" : "visible";
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };

    function stopRecordingIfNeeded() {
      if (recorder && recorder.recording) {
        recorder.stop();
        stream.getAudioTracks()[0].stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    }
  </script>
</body>
</html>
